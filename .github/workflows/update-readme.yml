name: Update README Timestamps

on:
  push:
    paths:
      - 'HiddifyConfigsCLI/bin/Debug/net8.0/valid_links.txt'
      - 'HiddifyConfigsCLI/bin/Debug/net8.0/valid_links_01.txt'
      - 'HiddifyConfigsCLI/bin/Debug/net8.0/valid_links_02.txt'
  schedule:
    # 每天北京时间 04:00（UTC 前一天 20:00）
    - cron: '0 20 * * *'
  workflow_dispatch:   # 手动触发

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      # -------------------------------------------------
      # 1. 拉取完整历史（必须，否则 HEAD~1 会报错）
      # -------------------------------------------------
      - name: Checkout repository with full history
        uses: actions/checkout@v4
        with:
          ref: master
          fetch-depth: 0

      # -------------------------------------------------
      # 2. 计算三个文件最近一次提交的时间（北京时间）
      # -------------------------------------------------
      - name: Get last-modified timestamps (Beijing time)
        id: timestamps
        run: |
          ALL_FILE="HiddifyConfigsCLI/bin/Debug/net8.0/valid_links.txt"
          PART01_FILE="HiddifyConfigsCLI/bin/Debug/net8.0/valid_links_01.txt"
          PART02_FILE="HiddifyConfigsCLI/bin/Debug/net8.0/valid_links_02.txt"

          format_time() {
            local f="$1"
            if [ ! -f "$f" ]; then
              echo "[Last Updated: File Not Found]"
              return
            fi
            # git log 取最近一次提交该文件的本地时间
            local ts
            ts=$(git log -1 --format="%cd" --date=format-local:'%Y-%m-%d %H:%M:%S
